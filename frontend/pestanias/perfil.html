<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ECOPHOS ‚Äî Mi perfil</title>
  <link rel="stylesheet" href="../css/style.css"/>
  <link rel="stylesheet" href="../css/styleLogin.css"/>
  <link rel="stylesheet" href="../css/styleProjects.css"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">ECOPHOS</div>
    <nav class="nav">
      <a href="../index.html" class="nav-link">Inicio</a>
      <a href="./nosotros.html" class="nav-link">Nosotros</a>
      <a href="./proyectos.html" class="nav-link">Proyectos</a>
      <a href="./servicios.html" class="nav-link">Servicios</a>
      <a href="./noticias.html" class="nav-link">Noticias</a>
      <a href="./contacto.html" class="nav-link">Contacto</a>
      <a href="./perfil.html" class="nav-link is-active">Mi perfil</a>
    </nav>
  </header>

  <main class="container auth">
    <section class="auth-card">
      <!-- Tabs -->
      <div class="auth-tabs">
        <button class="tab active" data-tab="login">Iniciar sesi√≥n</button>
        <button class="tab" data-tab="admin">Admin</button>
        <script>
          document.querySelector('.tab[data-tab="admin"]')
          ?.addEventListener('click', () => { window.location.href = './admin.html'; });
        </script>
      </div>

      <!-- Login -->
      <form id="loginForm" class="auth-form show">
        <label>Correo electr√≥nico
          <input name="email" type="email" required placeholder="tucorreo@ejemplo.com">
        </label>
        <label>Contrase√±a
          <input name="password" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </label>
        <button class="cta" type="submit">Entrar</button>
        <p class="form-msg" id="loginMsg"></p>
      </form>

      <!-- Perfil -->
      <div id="profileBox" class="profile-box" style="display: none;">
        <h3>Bienvenido üëã</h3>
        <form id="profile-form">
          <label>Nombre:
            <input type="text" id="profile-name" name="name" disabled />
          </label>
          <label>Correo:
            <input type="email" id="profile-email" name="email" disabled />
          </label>
          <label>Tel√©fono:
            <input type="text" id="profile-phone" name="phone" disabled />
          </label>
          <div class="buttons">
            <button type="button" id="edit-btn">Editar</button>
            <button type="submit" id="save-btn" disabled>Guardar cambios</button>
          </div>
          <p class="form-msg" id="editMsg"></p>
        </form>

        <!-- ====== Proyectos del usuario ====== -->
        <section class="project-panel">
          <div class="project-panel__head">
            <h3>Mis proyectos</h3>
            <small class="muted">Crea, lista o elimina tus proyectos personales.</small>
          </div>

          <form id="projectForm" class="project-form">
            <input type="text" id="projTitle" placeholder="T√≠tulo del proyecto" required />
            <textarea id="projDesc" placeholder="Descripci√≥n breve" required></textarea>
            <button type="submit" class="cta">Agregar proyecto</button>
            <p class="form-msg" id="projMsg"></p>
          </form>

          <ul id="projectList" class="project-list"></ul>

          <!-- Modal de gesti√≥n de proyectos (coincide con tu CSS: mg-modal, mg-card, mg-head, mg-body, mg-foot, mg-grid, mg-table, mg-chartwrap...) -->
          <div id="manageModal" class="mg-modal">
            <div class="mg-card" role="dialog" aria-modal="true" aria-labelledby="mgTitle">
              <!-- Header -->
              <div class="mg-head">
                <h3 id="mgTitle" class="mg-title"></h3>
                <button id="mgClose" class="mg-close" type="button" aria-label="Cerrar modal">‚úñ</button>
              </div>

              <!-- Body -->
              <div class="mg-body">
                <!-- Formulario compacto (usa las mismas names que espera el backend JS) -->
                <form id="taskForm" class="mg-grid">
                  <label>
                    Estado
                    <select name="status" required>
                      <option value="">Estado</option>
                      <option>Completado</option>
                      <option>En progreso</option>
                      <option>Pendiente</option>
                    </select>
                  </label>

                  <label>
                    Prioridad
                    <select name="priority" required>
                      <option value="">Prioridad</option>
                      <option>Alta</option>
                      <option>Media</option>
                      <option>Baja</option>
                    </select>
                  </label>

                  <label>
                    Responsable
                    <input type="text" name="owner" placeholder="Responsable" required />
                  </label>

                  <label>
                    Descripci√≥n
                    <input type="text" name="desc" placeholder="Descripci√≥n (opcional)" />
                  </label>

                  <button type="submit" class="cta">Agregar tarea</button>
                  <p id="taskMsg" class="form-msg"></p>
                </form>

                <!-- Tabla de tareas -->
                <div class="mg-tablewrap" style="margin-top:8px;">
                  <table class="mg-table">
                    <thead>
                      <tr>
                        <th>Estado</th>
                        <th>Prioridad</th>
                        <th>Responsable</th>
                        <th>Descripci√≥n</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody id="taskTbody">
                      <!-- Rellenado por JS -->
                    </tbody>
                  </table>
                </div>

                <!-- Gr√°fica + leyenda -->
                <div class="mg-chartwrap" style="margin-top:12px;">
                  <div class="mg-canvas">
                    <canvas id="tasksChart" aria-label="Gr√°fico de estado de tareas" role="img"></canvas>
                  </div>
                  <ul class="mg-legend">
                    <li><span class="dot done"></span> Completado</li>
                    <li><span class="dot prog"></span> En progreso</li>
                    <li><span class="dot pend"></span> Pendiente</li>
                  </ul>
                </div>
              </div>

              <!-- Footer -->
              <div class="mg-foot">
                <button id="mgBack" class="btn-outline" type="button">Volver</button>
              </div>
            </div>
          </div>

          <!-- Chart.js (aseg√∫rate de que est√© cargado antes de projects_profile.js) -->
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        </section>

        <button class="btn-outline" id="logoutBtn">Cerrar sesi√≥n</button>
      </div>
    </section>
  </main>

  <script src="../js/auth.js"></script>
  <script src="../js/perfil.js"></script>
  <script src="../js/projects_profile.js"></script>
</body>
</html>
